---
import BaseLayout from '../layouts/BaseLayout.astro';
import Section from '../components/Section.astro';
import Button from '../components/Button.astro';
import ProjectCard from '../components/ProjectCard.astro';
import PostCard from '../components/PostCard.astro';
import Card from '../components/Card.astro';
import { site, highlights, metrics, featuredHighlights } from '../data/site';
import { getCollection } from 'astro:content';

const projects = (await getCollection('projects'))
  .filter((project) => project.data.featured)
  .slice(0, 3);
const posts = (await getCollection('blog'))
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf())
  .slice(0, 3);
---

<BaseLayout title={site.title} description={site.description}>
  <section class="section hero">
    <div class="container hero__wrap">
      <div>
        <p class="eyebrow">Data Engineer</p>
        <h1 class="hero__title reveal">ETL pipelines and KPI reporting you can trust.</h1>
        <p class="hero__subtitle reveal reveal-delay-1">
          I build end-to-end data pipelines in Python, PySpark, and SQL on Databricks, then deliver
          Power BI dashboards for finance and leadership teams.
        </p>
        <div class="hero__actions" style="display: flex; gap: var(--space-3); flex-wrap: wrap;">
          <Button href="/portfolio">Explore work</Button>
          <Button href="/contact" variant="outline"> Start a project </Button>
        </div>
        <div class="hero__metrics">
          {
            metrics.map((metric) => (
              <div class="metric">
                <strong>{metric.value}</strong>
                <span>{metric.label}</span>
              </div>
            ))
          }
        </div>
      </div>
      <div class="surface surface--raised hero__panel reveal reveal-delay-2">
        <p class="kicker">Now building</p>
        <h2 style="font-size: var(--step-2); margin-bottom: var(--space-4);">
          Reporting pipelines that stay accurate, reusable, and easy to evolve.
        </h2>
        <div class="listing">
          {
            featuredHighlights.map((item) => (
              <div>
                <p class="kicker">{item.label}</p>
                <strong>{item.title}</strong>
              </div>
            ))
          }
        </div>
      </div>
    </div>
  </section>

  <Section
    eyebrow="Highlights"
    title="Focused on outcomes, not just pipelines"
    subtitle="Data engineering should unlock confident decisions. Here's where I spend the most energy."
  >
    <div class="grid grid--3">
      {
        highlights.map((item) => (
          <Card>
            <h3>{item.title}</h3>
            <p>{item.description}</p>
          </Card>
        ))
      }
    </div>
  </Section>

  <Section
    eyebrow="Portfolio"
    title="Featured projects"
    subtitle="A selection of ETL pipelines, KPI reporting, and analytics delivery."
  >
    <div class="grid grid--3" data-card-grid>
      {projects.map((project) => <ProjectCard project={project} />)}
    </div>
    <div style="margin-top: var(--space-5);">
      <Button href="/portfolio" variant="ghost"> View the full portfolio </Button>
    </div>
  </Section>

  <Section
    eyebrow="Latest writing"
    title="Notes from the field"
    subtitle="Playbooks, frameworks, and lessons learned while shipping data platforms."
  >
    <div class="grid grid--3" data-card-grid>
      {posts.map((post) => <PostCard post={post} />)}
    </div>
  </Section>

  <Section
    eyebrow="Work together"
    title="Let's build your next reporting pipeline"
    subtitle="Need ETL help, dashboard delivery, or a data refresh? Let's align on the next steps."
  >
    <div
      class="surface"
      style="display: flex; flex-wrap: wrap; gap: var(--space-4); align-items: center;"
    >
      <div style="flex: 1 1 260px;">
        <p class="kicker">Get in touch</p>
        <h3 style="font-size: var(--step-2);">
          <a href={`mailto:${site.email}`}>{site.email}</a>
        </h3>
      </div>
      <div style="display: flex; gap: var(--space-3);">
        <Button href="/contact">Contact me</Button>
        <Button href="/resume" variant="outline"> View resume </Button>
      </div>
    </div>
  </Section>
</BaseLayout>
